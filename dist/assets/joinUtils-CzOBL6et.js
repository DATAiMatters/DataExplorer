function y(s,o,r){const n=s.source.parsedData,t=o.source.parsedData,e=s.source.columns,l=o.source.columns,u=r.conditions.map(i=>({leftColumn:d(s.mappings,i.leftRoleId),rightColumn:d(o.mappings,i.rightRoleId),operator:i.operator}));if(u.filter(i=>!i.leftColumn||!i.rightColumn).length>0)throw new Error("Join condition references missing columns");let c,f=0,m=0;switch(r.joinType){case"inner":c=b(n,t,u),f=h(c,e),m=h(c,l);break;case"left":c=C(n,t,u,l),f=n.length,m=h(c.filter(i=>!g(i,l)),l);break;case"right":c=N(n,t,u,e),f=h(c.filter(i=>!g(i,e)),e),m=t.length;break;case"full":c=x(n,t,u,e,l),f=h(c.filter(i=>!g(i,e)),e),m=h(c.filter(i=>!g(i,l)),l);break;default:throw new Error(`Unsupported join type: ${r.joinType}`)}return{data:c,leftColumns:e,rightColumns:l,stats:{leftRows:n.length,rightRows:t.length,resultRows:c.length,matchedLeftRows:f,matchedRightRows:m}}}function b(s,o,r){const n=[];for(const t of s)for(const e of o)w(t,e,r)&&n.push(a(t,e));return n}function C(s,o,r,n){const t=[];for(const e of s){let l=!1;for(const u of o)w(e,u,r)&&(t.push(a(e,u)),l=!0);l||t.push(a(e,p(n)))}return t}function N(s,o,r,n){const t=[];for(const e of o){let l=!1;for(const u of s)w(u,e,r)&&(t.push(a(u,e)),l=!0);l||t.push(a(p(n),e))}return t}function x(s,o,r,n,t){const e=[],l=new Set;for(const u of s){let R=!1;for(let c=0;c<o.length;c++){const f=o[c];w(u,f,r)&&(e.push(a(u,f)),l.add(c),R=!0)}R||e.push(a(u,p(t)))}for(let u=0;u<o.length;u++)l.has(u)||e.push(a(p(n),o[u]));return e}function w(s,o,r){return r.every(n=>{const t=s[n.leftColumn],e=o[n.rightColumn];switch(n.operator){case"=":return t===e;case"!=":return t!==e;case">":return Number(t)>Number(e);case"<":return Number(t)<Number(e);case">=":return Number(t)>=Number(e);case"<=":return Number(t)<=Number(e);case"like":return String(t).includes(String(e));default:return!1}})}function a(s,o){const r={};for(const[n,t]of Object.entries(s))r[`left_${n}`]=t;for(const[n,t]of Object.entries(o))r[`right_${n}`]=t;return r}function p(s){const o={};for(const r of s)o[r]=null;return o}function g(s,o){return o.every(r=>s[`left_${r}`]===null||s[`right_${r}`]===null)}function h(s,o){const r=new Set;for(const n of s){const t=o.map(e=>n[`left_${e}`]||n[`right_${e}`]).join("|");r.add(t)}return r.size}function d(s,o){return s.find(n=>n.roleId===o)?.sourceColumn||""}export{y as executeJoin};
